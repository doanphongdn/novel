{% load i18n %}
{% load static %}

<div class="chapter-content">
    <div class="row chapter-actions">
        <div class="col-4">
            <div class="row">
                {% if chapter_prev_url %}
                    <a href="{{ chapter_prev_url }}">
                        <button type="button" class="btn btn-sm btn-default d-lg-none">
                            <i class="fa fa-chevron-left"></i> Prev
                        </button>
                        <button type="button" class="btn btn-default d-none d-lg-block">
                            <i class="fa fa-chevron-left"></i> Prev
                        </button>
                    </a>
                {% endif %}
            </div>
        </div>
        <div class="col-4">
            <div class="row justify-content-center">
                <button type="button" class="btn btn-sm btn-default d-lg-none mr-1" data-toggle="modal"
                        data-target="#modal-chapter">
                    <i class="fa fa-list"></i>
                </button>
                <button type="button" class="btn btn-default d-none d-lg-block mr-1" data-toggle="modal"
                        data-target="#modal-chapter">
                    <i class="fa fa-list"></i> Chapter List
                </button>
                <a href="#" data-toggle="modal" data-target="#modal-report" rel="nofollow">
                    <button class="btn btn-sm btn-warning text-center d-lg-none ml-1" >
                        <i class="fa fa-bug"></i>
                    </button>
                </a>
                <a href="#" data-toggle="modal" data-target="#modal-report" rel="nofollow">
                    <button class="btn btn-warning text-center d-none d-lg-block ml-1" >
                        <i class="fa fa-bug"></i> {% translate "Error report" %}
                    </button>
                </a>
            </div>
        </div>
        <div class="col-4">
            <div class="row justify-content-end">
                {% if chapter_next_url %}
                    <a href="{{ chapter_next_url }}">
                        <button type="button" class="btn btn-sm btn-default d-lg-none">
                            Next <i class="fa fa-chevron-right"></i>
                        </button>
                        <button type="button" class="btn btn-default d-none d-lg-block">
                            Next <i class="fa fa-chevron-right"></i>
                        </button>
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row chapter-header">
        <div class="col-12 chapter-title">
            <h3>{{ novel.name }}</h3>
            <h5>{{ chapter.name }}</h5>
        </div>
    </div>
    <hr class="hr-light">
    <div class="row chapter-detail">
        <div class="col-12">
            {% autoescape off %}
                {{ chapter.decompress_content }}
            {% endautoescape %}
            {% if stream_images %}
                <p class="bg-yellow text-center text-uppercase box-warning">{% translate "Please visit this chapter after 5 minutes if your browser cannot load these images now." %}</p>
            {% endif %}
            {% if mix_images %}
                {% for mix_image in mix_images %}
                    {% if forloop.counter <= 3 %}
                        {% if "/images/" not in mix_image %}
                            <img src="{{ cdn_domain }}/{{ mix_image }}" alt="">
                        {% else %}
                            <img src="{{ mix_image }}" alt="">
                        {% endif %}
                    {% else %}
                        {% if "/images/" not in mix_image %}
                            <img data-src="{{ cdn_domain }}/{{ mix_image }}" src="{% static "images/lazyload.gif" %}"
                                 alt=""
                                 class="lazyload">
                        {% else %}
                            <img data-src="{{ mix_image }}" src="{% static "images/lazyload.gif" %}" alt=""
                                 class="lazyload">
                        {% endif %}
                    {% endif %}
                {% endfor %}
            {% elif cdn_images %}
                {% for cdn_image in cdn_images %}
                    {% if forloop.counter <= 3 %}
                        <img src="{{ cdn_domain }}/{{ cdn_image }}" alt="">
                    {% else %}
                        <img data-src="{{ cdn_domain }}/{{ cdn_image }}" src="{% static "images/lazyload.gif" %}" alt=""
                             class="lazyload">
                    {% endif %}
                {% endfor %}
            {% endif %}
            {% if not mix_images %}
                {% for image_url in stream_images %}
                    {% if forloop.counter > cdn_images|length and forloop.counter <= cdn_images|length|add:"2" %}
                        <img src="{{ image_url }}" alt="">
                    {% elif forloop.counter > cdn_images|length|add:"2" %}
                        <img data-src="{{ image_url }}" src="{% static "images/lazyload.gif" %}" alt=""
                             class="lazyload">
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>
    </div>
    <hr class="hr-text" data-content="END CHAPTER">
    {% if chapter.next_chapter %}
        <div class="col-12 chapter-hashtags">
            <a href="{{ chapter_next_url }}" class="btn btn-sm btn-warning"
               title="{{ novel.name }} {{ chapter_next_name }}">{{ novel.name }} {{ chapter_next_name }}</a>
        </div>
    {% endif %}
</div>

<div class="modal fade modal-chapter" id="modal-chapter" tabindex="-1" role="dialog" aria-labelledby="modal-chapter"
     aria-hidden="true">
    <div class="modal-dialog modal- modal-dialog-centered modal-" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">Ã—</span>
                </button>
            </div>
            <div class="modal-body" id="chapter-list">
                <ul>
                    {% for chap in chapter_list %}
                        <li>
                            <a href="{{ chap.url }}">{{ chap.name }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
