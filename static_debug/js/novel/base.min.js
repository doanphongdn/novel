$(document).ready(function(e){$("input.search").autocomplete({source:function(e,t){$.ajax({type:"POST",url:"/search",dataType:"json",data:{q:e.term,csrfmiddlewaretoken:$('input[name="csrfmiddlewaretoken"]').val()},success:function(e){t(e.data)}})},appendTo:"#search-area",minLength:3,select:function(e,t){$(location).attr("href",t.item.url)}}).data("ui-autocomplete")._renderItem=function(e,t){var n='<li class="search-item ui-menu-item" tabindex="-1">';return n+='<img src="'+t.thumbnail_image+'" alt="'+t.name+'">',n+='<h5 class="search-item-title">'+t.name+"</h5>",n+="</li>",$(n).appendTo(e)},$(".mobile-search-toggle").on("click",function(e){$(".search-wrap").slideToggle("fast")}),$("input.search").keydown(function(e){if(13==e.keyCode&&0==$("input.search").val().length)return e.preventDefault(),!1});$(".lazyload").Lazy({scrollDirection:"vertical",effect:"fadeIn",effectTime:200,visibleOnly:!0,onError:function(e){e.attr("src","/static/images/lazyload.gif")}}),$("#modal-login").on("show.bs.modal",function(e){var t=$(e.relatedTarget);$(this).find("input:not([type=hidden])").each(function(e){$(this).val("")}),t.hasClass("btn-register")?$(this).find("a.tab-register").tab("show"):$(this).find("a.tab-login").tab("show")}),$(".btn-reply-comment").on("click",function(e){let t=$(this).parents(".comment-content-reply"),n=$(this).data("comment-id"),a=$(this).data("parent-id"),i=$("form.comment-form").find("#id_novel_id").val(),s=$("form.comment-form").find("#id_chapter_id").val();$.ajax({type:"POST",url:"/comment/form",dataType:"json",data:{parent_id:a,reply_id:n,novel_id:i,chapter_id:s,csrfmiddlewaretoken:$('input[name="csrfmiddlewaretoken"]').val()},success:function(e){for(instance in CKEDITOR.instances)"cke_novel_id"!==instance&&CKEDITOR.instances[instance].destroy();$(".comment-list form.comment-reply-form").remove(),$(e.html).appendTo(t),$.each($("form.comment-reply-form textarea"),function(e,t){CKEDITOR.replace(t.id,JSON.parse(t.getAttribute("data-config")))})}})}),$(document).on("submit",".comment-form, .comment-reply-form",function(e){let t=$(this);for(instance in e.preventDefault(),CKEDITOR.instances)CKEDITOR.instances[instance].updateElement();var n=$(this).serializeArray();grecaptcha.execute(recapcha_site_key,{action:"submit"}).then(function(e){n.push({name:"g-recaptcha-response",value:$("*[name='g-recaptcha-response']").val()}),$.ajax({type:"POST",url:"/comment",dataType:"json",data:n,success:function(e){if(e.success){for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement();CKEDITOR.instances[instance].setData(""),grecaptcha.reset(recapcha_site_key),t.hasClass("comment-reply-form")?(t.parents(".comment-item").after(e.html),t.remove()):$(".comment-list").prepend(e.html)}}})})}),$(document).on("submit","#register-form",function(e){e.preventDefault();var t=$(this);$.ajax({type:"post",url:"/user/signup",data:t.serializeArray(),success:function(e){0==e.success?($(".message.register").html(""),$.each(e.errors,function(e,t){$(".message.register").append(t+"</br>")})):location.reload()}})}),$(document).on("submit","#login-form",function(e){e.preventDefault();var t=$(this);$.ajax({type:"post",url:"/user/signin",data:t.serializeArray(),success:function(e){$(".message.login").html(""),!0===e.success?$(location).attr("href",e.redirect_to):$.each(e.errors,function(e,t){$(".message.login").append(t+"</br>")})}})})});